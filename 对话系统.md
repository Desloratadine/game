## å¯¹è¯ç³»ç»Ÿ

**lua**

luaå¯¹è¯è¡¨ c#è¯»å–

å¯¼å…¥xluaï¼Œåˆå§‹åŒ–ç¯å¢ƒ

###### æ‹–åŠ¨èµ‹å€¼

TextAsset çš„ luaè„šæœ¬ -ã€‹åœ¨èŠ‚ç‚¹å†…è§£æluaæ•°æ®

```lua

    [SerializeField] private TextAsset luaFile;  // æ‹–å…¥ Lua æ–‡ä»¶
    private LuaTable dialogueData;               // è§£æåçš„ Lua æ•°æ®

    public string Speaker { get; private set; }
    public string Text { get; private set; }
    public string NextNodeId { get; private set; }

    // åˆå§‹åŒ–æ—¶è§£æ Lua
    public void Init(LuaEnv luaEnv)
    {
        if (luaFile == null) return;
        
        // æ‰§è¡Œ Lua è„šæœ¬
        luaEnv.DoString(luaFile.text);
        
        // è·å–è¿”å›çš„ Table
        dialogueData = luaEnv.Global.Get<LuaTable>("dialogue");
        
        // è¯»å–å­—æ®µ
        Speaker = dialogueData.Get<string>("speaker");
        Text = dialogueData.Get<string>("text");
        NextNodeId = dialogueData.Get<string>("next");
    }
```



###### åŠ¨æ€åŠ è½½

```lua

    // è·å–å¯¹è¯å†…å®¹
    LuaTable dialogue = luaEnv.Global.Get<LuaTable>(currentDialogueId);
    string speaker = dialogue.Get<string>("speaker");
    string text = dialogue.Get<string>("text");
    int nextId = dialogue.Get<int>("next"); // å¯èƒ½ä¸º nil
```



**ink**

### **x-node**

#### åŸºç¡€

èŠ‚ç‚¹ï¼šåŒ…å«ç«¯å£ï¼ŒåŠ¨æ€æ·»åŠ /åˆ é™¤ï¼Œå¯ä»¥é€šè¿‡ä»£ç è·å–

æ ‘çŠ¶ç»“æ„

#æ ¹æ®åˆ—è¡¨ç”Ÿæˆå¤šä¸ªç«¯å£

åœ¨ **xNode** ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä»£ç è®¿é—®å’Œéå†èŠ‚ç‚¹ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š

| æ–¹æ³•                    | ç”¨é€”                   | ç¤ºä¾‹                                 |
| ----------------------- | ---------------------- | ------------------------------------ |
| `graph.nodes`           | è·å–æ‰€æœ‰èŠ‚ç‚¹           | `foreach (Node node in graph.nodes)` |
| `node is T`             | è·å–ç‰¹å®šç±»å‹èŠ‚ç‚¹       | `if (node is DialogueNode)`          |
| `GetOutputPort("next")` | è·å–è¿æ¥çš„ä¸‹ä¸€èŠ‚ç‚¹     | `outputPort.Connection.node`         |
| `GetInputPort("prev")`  | è·å–è¿æ¥çš„ä¸Šä¸€èŠ‚ç‚¹     | `inputPort.Connection.node`          |
| `FindNodeByName`        | æŒ‰åç§°æŸ¥æ‰¾èŠ‚ç‚¹         | `FindNodeByName("Intro")`            |
| `GetConnections()`      | è·å–æ‰€æœ‰è¿æ¥ï¼ˆå¤šåˆ†æ”¯ï¼‰ | `outputPort.GetConnections()`        |

ä½ å¯ä»¥æ ¹æ®éœ€æ±‚ç»„åˆè¿™äº›æ–¹æ³•ï¼Œå®ç° **å¯¹è¯è·³è½¬ã€åˆ†æ”¯é€‰æ‹©ã€åŠ¨æ€ä¿®æ”¹å‰§æƒ…** ç­‰åŠŸèƒ½ã€‚ğŸš€

#### å…ƒç´ 

èµ·å§‹èŠ‚ç‚¹/å™è¿°èŠ‚ç‚¹/é€‰æ‹©èŠ‚ç‚¹

æ‰‹åŠ¨æ³¨å†Œäº‹ä»¶

è®²è¿°è€…/

æ•°å€¼/

Dialog Contentæ–‡æœ¬ï¼ˆå†…å®¹ï¼‰/

Dialog Chooseé€‰é¡¹/å•æ¬¡é€‰é¡¹ï¼ˆåˆ—è¡¨ï¼‰

è¾“å…¥&è¾“å‡ºï¼š

#### é…ç½®

æŠŠå›¾é…ç½®åˆ°uiä¸Šï¼š

###### class-dialog_manager

å¼•ç”¨å›¾å’Œå½“å‰uiæ§ä»¶ï¼Œ

å½“å‰èŠ‚ç‚¹è·å–/æ›´æ–°

æ˜¾ç¤ºå¯¹è¯ï¼ˆè¯»å–èŠ‚ç‚¹å†…å®¹èµ‹å€¼UIæ§ä»¶ï¼‰

è§¦å‘å¯¹è¯çš„æ–¹æ³•

